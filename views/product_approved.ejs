<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->

<head>
    <%- include('_layouts/head') %>
        <title>Approved Products | <%= title %>
        </title>
        <link rel="stylesheet" type="text/css" href="/app-assets/vendors/data-tables/css/jquery.dataTables.min.css">
        <link rel="stylesheet" type="text/css"
            href="/app-assets/vendors/data-tables/extensions/responsive/css/responsive.dataTables.min.css">
        <link rel="stylesheet" type="text/css" href="/app-assets/vendors/data-tables/css/select.dataTables.min.css">
        <link rel="stylesheet" type="text/css" href="/app-assets/css/pages/data-tables.css">
</head>
<!-- END: Head-->

<body
    class="vertical-layout page-header-light vertical-menu-collapsible vertical-dark-menu preload-transitions 2-columns"
    data-open="click" data-menu="vertical-dark-menu" data-col="2-columns">

    <%- include('_layouts/sidenavbar') %>

        <!-- BEGIN: Page Main-->
        <div id="main">
            <div class="row">
                <div class="pt-1 pb-0" id="breadcrumbs-wrapper">
                    <div class="container">
                        <div class="row">
                            <%- include('messages', { messages: messages }) %>
                                <div class="col s12 m6 l6">
                                    <h6 class="breadcrumbs-title"><span>Approved Products</span></h6>
                                </div>
                                <div class="col s12 m6 l6 right-align-md" style="margin-top: -10px;">
                                    <ol class="breadcrumbs mb-0">
                                        <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
                                        <li class="breadcrumb-item active">Approved Products</li>
                                    </ol>
                                </div>
                        </div>
                    </div>
                </div>

                <div class="col s12">
                    <div class="container">
                        <div class="section section-data-tables">
                            <!-- Navigation Tabs -->
                            <div class="row">
                                <div class="col s12">
                                    <div style="margin-bottom: 20px;">
                                        <a href="/admin/product/pending-approvals" class="waves-effect waves-light btn grey lighten-1 mr-1 mb-2">
                                            <i class="material-icons left">access_time</i>Pending
                                        </a>
                                        <a href="/admin/product/approved" class="waves-effect waves-light btn green mr-1 mb-2">
                                            <i class="material-icons left">check_circle</i>Approved
                                        </a>
                                        <a href="/admin/product/rejected" class="waves-effect waves-light btn grey lighten-1 mr-1 mb-2">
                                            <i class="material-icons left">cancel</i>Rejected
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Page Length Options -->
                            <div class="row">
                                <div class="col s12">
                                    <div class="card">
                                        <div class="card-content">
                                            <div class="row">
                                                <div class="col s12 overflow">
                                                    <table id="page-length-option" class="display">
                                                        <thead>
                                                            <tr>
                                                                <th>Sr</th>
                                                                <th>Image</th>
                                                                <th>User Name</th>
                                                                <th>Title</th>
                                                                <th>Category</th>
                                                                <th>Approved Date</th>
                                                                <th>Approved By</th>
                                                                <th data-orderable="false">Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% if (products && products.length > 0) { %>
                                                                <% for(let i=0; i < products.length; i++) { %>
                                                                    <tr>
                                                                        <td>
                                                                            <%= i + 1 %>
                                                                        </td>
                                                                        <td>
                                                                            <img src="<%= products[i].images && products[i].images.length > 0 ? process.env.IMAGE_URL + products[i].images[0] : '/images/default.png' %>"
                                                                                style="width: 80px; height: 80px; object-fit: cover; border-radius: 4px;">
                                                                        </td>
                                                                        <td>
                                                                            <%= products[i].user?.name || '-' %>
                                                                        </td>
                                                                        <td>
                                                                            <%= products[i].title %>
                                                                        </td>
                                                                        <td>
                                                                            <%= products[i].category && products[i].category.length > 0 ? products[i].category[0]?.name : '-' %>
                                                                        </td>
                                                                        <td>
                                                                            <% if (products[i].approvalDate) { %>
                                                                                <% const approvalDate = new Date(products[i].approvalDate); %>
                                                                                <% const day = String(approvalDate.getUTCDate()).padStart(2, '0'); %>
                                                                                <% const month = String(approvalDate.getUTCMonth() + 1).padStart(2, '0'); %>
                                                                                <% const year = approvalDate.getUTCFullYear(); %>
                                                                                <%= day %>-<%= month %>-<%= year %>
                                                                            <% } else { %>
                                                                                -
                                                                            <% } %>
                                                                        </td>
                                                                        <td>
                                                                            <%= products[i].approvedBy?.name || '-' %>
                                                                        </td>
                                                                        <td>
                                                                            <a href="/admin/product/approval-view/<%= products[i]._id %>"
                                                                                class="btn-floating waves-effect waves-light blue">
                                                                                <i class="material-icons">visibility</i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                <% } %>
                                                            <% } else { %>
                                                                <tr>
                                                                    <td colspan="8" style="text-align: center;">No approved products found</td>
                                                                </tr>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="content-overlay"></div>
                </div>
            </div>
        </div>
        <!-- END: Page Main-->

        <%- include('_layouts/commonJs') %>

            <!-- Only include DataTables once -->
            <script src="/app-assets/vendors/data-tables/js/jquery.dataTables.min.js"></script>

            <!-- Your custom DataTable initialization -->
            <script>
                $(document).ready(function () {
                    // Prevent multiple initializations
                    if (!$.fn.DataTable.isDataTable('#page-length-option')) {
                        $('#page-length-option').DataTable({
                            responsive: true,
                            pageLength: 10,
                            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
                            order: [[5, 'desc']], // Sort by approval date descending
                            columnDefs: [
                               { orderable: false, targets: [7] }
                            ]
                        });
                    }
                });
            </script>

</body>

</html>
